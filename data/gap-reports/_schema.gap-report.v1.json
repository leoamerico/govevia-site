{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "govevia://schemas/gap-report.v1",
  "title": "Govevia Gap Report v1",
  "type": "object",
  "required": ["version", "account", "generated_at", "scope", "findings", "limitations"],
  "properties": {
    "version": { "type": "string", "const": "gap-report.v1" },
    "generated_at": { "type": "string", "format": "date-time" },
    "account": {
      "type": "object",
      "required": ["type", "id", "name", "uf"],
      "properties": {
        "type": {
          "type": "string",
          "enum": [
            "prefeitura",
            "camara",
            "autarquia",
            "consorcio",
            "empresa_publica",
            "controle_interno",
            "controle_externo",
            "ministerio_publico"
          ]
        },
        "id": { "type": "string", "minLength": 2 },
        "name": { "type": "string", "minLength": 2 },
        "uf": { "type": "string", "pattern": "^[A-Z]{2}$" }
      }
    },
    "scope": {
      "type": "object",
      "required": ["theme", "period"],
      "properties": {
        "theme": { "type": "string", "minLength": 3 },
        "period": { "type": "string", "minLength": 3 },
        "sources": {
          "type": "array",
          "items": {
            "type": "object",
            "required": ["kind", "url"],
            "properties": {
              "kind": { "type": "string", "enum": ["transparencia", "diario_oficial", "site_institucional", "outro"] },
              "url": { "type": "string", "minLength": 8 }
            }
          }
        }
      }
    },
    "findings": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "required": ["id", "title", "severity", "statement", "evidence", "impact", "recommendation"],
        "properties": {
          "id": { "type": "string", "pattern": "^GAP-[0-9]{3}$" },
          "title": { "type": "string", "minLength": 5 },
          "severity": { "type": "string", "enum": ["P0", "P1", "P2"] },
          "statement": { "type": "string", "minLength": 10 },
          "evidence": {
            "type": "array",
            "minItems": 1,
            "items": {
              "type": "object",
              "required": ["type", "ref"],
              "properties": {
                "type": { "type": "string", "enum": ["url", "snapshot_hash", "doc_ref"] },
                "ref": { "type": "string", "minLength": 5 }
              }
            }
          },
          "impact": {
            "type": "object",
            "required": ["risk", "why_it_matters"],
            "properties": {
              "risk": { "type": "string", "minLength": 5 },
              "why_it_matters": { "type": "string", "minLength": 10 },
              "metrics_hint": { "type": "string" }
            }
          },
          "recommendation": {
            "type": "object",
            "required": ["action", "expected_outcome"],
            "properties": {
              "action": { "type": "string", "minLength": 10 },
              "expected_outcome": { "type": "string", "minLength": 10 },
              "links": { "type": "array", "items": { "type": "string" } }
            }
          }
        }
      }
    },
    "limitations": {
      "type": "array",
      "minItems": 2,
      "items": { "type": "string", "minLength": 10 }
    }
  }
}
